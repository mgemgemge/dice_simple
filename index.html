<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dice Duel</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
    }
    button {
      padding: 16px 32px;
      font-size: 20px;
      margin: 16px 0;
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    #roll { background: #3b82f6; }
    #challenge { background: #ef4444; }
    #ui {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.85);
      padding: 16px;
      z-index: 1000;
    }
    #dice-container {
      font-size: 60px;
      margin: 20px;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .dice-pair {
      display: flex;
      gap: 30px;
      margin-bottom: 10px;
    }
    .dice-value {
      font-size: 24px;
      color: #4ade80;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="ui">
    <div id="welcome">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="balance">üí∞ –ë–∞–ª–∞–Ω—Å: ‚Äî</div>
  </div>

  <h2>üé≤ Dice Duel</h2>
  <button id="roll">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
  <button id="challenge">–í—ã–∑–≤–∞—Ç—å –¥—Ä—É–≥–∞</button>

  <div id="dice-container">
    <div class="dice-pair">
      <div>?</div>
      <div>?</div>
    </div>
    <div class="dice-value" id="dice-values">‚Äî</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const welcomeEl = document.getElementById('welcome');
      const balanceEl = document.getElementById('balance');

      if (!window.Telegram?.WebApp?.initDataUnsafe?.user) {
        welcomeEl.textContent = '‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram!';
        balanceEl.style.display = 'none';
        return;
      }

      const user = window.Telegram.WebApp.initDataUnsafe.user;
      const name = user.username || user.first_name || '–¥—Ä—É–≥';

      let balance = localStorage.getItem('dice_balance');
      if (!balance) {
        balance = 500;
        localStorage.setItem('dice_balance', '500');
      } else {
        balance = Number(balance);
      }

      welcomeEl.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}!`;
      balanceEl.textContent = `üí∞ –ë–∞–ª–∞–Ω—Å: ${balance} –º–æ–Ω–µ—Ç`;

      // –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞
      document.getElementById('roll').onclick = () => {
        const dicePair = document.querySelector('.dice-pair');
        const valuesEl = document.getElementById('dice-values');
        const totalSteps = 10;
        let step = 0;

        // –ê–Ω–∏–º–∞—Ü–∏—è: –º–µ–ª—å–∫–∞—é—â–∏–µ –∫—É–±–∏–∫–∏
        const animate = () => {
          if (step < totalSteps) {
            dicePair.innerHTML = `<div>üé≤</div><div>üé≤</div>`;
            step++;
            setTimeout(animate, 80);
          } else {
            // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const d1 = Math.floor(Math.random() * 6) + 1;
            const d2 = Math.floor(Math.random() * 6) + 1;
            dicePair.innerHTML = `<div>üé≤</div><div>üé≤</div>`;
            valuesEl.textContent = `${d1} + ${d2} = ${d1 + d2}`;
            
            if (window.navigator.vibrate) {
              window.navigator.vibrate([100, 50, 100]);
            }
          }
        };

        // –°–±—Ä–æ—Å
        dicePair.innerHTML = `<div>?</div><div>?</div>`;
        valuesEl.textContent = '‚Äî';
        setTimeout(animate, 100);
      };

      // –í—ã–∑–æ–≤ –¥—Ä—É–≥–∞
      document.getElementById('challenge').onclick = () => {
        const betStr = prompt('–°–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å? (–ú–∏–Ω–∏–º—É–º: 10)');
        const bet = parseInt(betStr);

        if (!betStr || isNaN(bet) || bet < 10 || bet > balance) {
          alert('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 10 –º–æ–Ω–µ—Ç –∏ –Ω–µ –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞!');
          return;
        }

        const BOT_NAME = 'kostochki_game_bot';
        const mention = user.username ? `@${user.username}` : user.first_name;
        const message = `${mention} –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥—É—ç–ª—å! –°—Ç–∞–≤–∫–∞: ${bet} –º–æ–Ω–µ—Ç üé≤\n\n–ò–≥—Ä–∞—Ç—å: https://t.me/${BOT_NAME}?startapp=duel_${bet}`;

        navigator.clipboard.writeText(message).then(() => {
          alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥—Ä—É–≥—É –≤ —á–∞—Ç.');
        }).catch(() => {
          prompt('‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:', message);
        });
      };

      Telegram.WebApp.ready();
    });
  </script>
</body>
</html>
